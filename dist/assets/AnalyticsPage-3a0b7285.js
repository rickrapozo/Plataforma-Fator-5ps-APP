import{b as U,u as I,j as e,e as x,g as H}from"./index-22ae1aea.js";import{r as c}from"./vendor-abc4fb99.js";import{a as F,L as A}from"./router-4d0cf74f.js";import{$,g as q,m as l,n as Q,v as B,a as R,a9 as K,aa as _,a3 as k,a0 as G,j as b,T as j,a2 as J,K as W}from"./ui-4d99af29.js";import"./pdf-eb8c75c2.js";const te=()=>{const T=F(),{isAdmin:O}=U(),[r,P]=c.useState(null),[d,S]=c.useState({}),[m,C]=c.useState({}),[u,N]=c.useState(0),[n,D]=c.useState(null),[o,f]=c.useState(!1),{isLoading:h,isAuthorized:p,error:w,logAction:y}=I();if(c.useEffect(()=>{!h&&p&&(E(),y("analytics_access",{refreshKey:u}))},[u,h,p,y]),h)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-deep-teal via-ocean-blue to-royal-purple flex items-center justify-center",children:e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx($,{className:"w-16 h-16 text-royal-gold mx-auto mb-4 animate-spin"}),e.jsx("h1",{className:"text-white text-2xl font-bold mb-2",children:"Verificando Acesso"}),e.jsx("p",{className:"text-pearl-white/80",children:"Validando suas credenciais administrativas..."})]})});if(!p||w)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-deep-teal via-ocean-blue to-royal-purple flex items-center justify-center",children:e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(q,{className:"w-16 h-16 text-error-red mx-auto mb-4"}),e.jsx("h1",{className:"text-white text-2xl font-bold mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-pearl-white/80 mb-6",children:w||"Você não tem permissão para acessar os analytics."}),e.jsx("button",{onClick:()=>T("/admin"),className:"bg-royal-gold hover:bg-bright-gold text-deep-teal px-6 py-2 rounded-lg font-semibold transition-colors",children:"Voltar ao Painel"})]})});const E=()=>{const s=x.getAnalyticsData(),t=x.getPageViewMetrics(),a=x.getRedirectAnalytics();P(s),S(t),C(a)},V=async()=>{if(r){f(!0);try{const s={totalEvents:r.events.length,totalPageViews:r.pageViews.length,totalRedirects:r.redirects.length,topPages:Object.entries(d.pageViews||{}).sort(([,a],[,i])=>i-a).slice(0,5),userEngagement:{averageTimeOnPage:d.averageTimeOnPage||0,bounceRate:d.bounceRate||0},redirectPatterns:Object.entries(m.sources||{}).sort(([,a],[,i])=>i-a).slice(0,5)},t=await H.generateCustomAnalysis({type:"user_behavior",data:s,context:"Análise de comportamento do usuário na plataforma Essential Factor"});D(t)}catch(s){console.error("Erro ao gerar análise AI:",s)}finally{f(!1)}}},L=()=>{const s=x.exportAnalyticsData(),t=new Blob([s],{type:"application/json"}),a=URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`analytics-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)},z=()=>{window.confirm("Tem certeza que deseja limpar todos os dados de analytics? Esta ação não pode ser desfeita.")&&(x.clearAnalyticsData(),N(s=>s+1))},M=s=>{const t=Math.floor(s/1e3),a=Math.floor(t/60),i=t%60;return`${a}:${i.toString().padStart(2,"0")}`};if(!O())return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-deep-forest via-forest-green to-sage-green flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Acesso Negado"}),e.jsx("p",{className:"text-sage-green/80 mb-6",children:"Você não tem permissão para acessar esta página."}),e.jsx(A,{to:"/app/dashboard",children:e.jsx(l.button,{className:"px-6 py-3 bg-royal-gold hover:bg-royal-gold/90 text-white rounded-lg font-semibold transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Voltar ao Dashboard"})})]})});if(!r)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-deep-forest via-forest-green to-sage-green flex items-center justify-center",children:e.jsx("div",{className:"text-white text-lg",children:"Carregando dados de analytics..."})});const v=[{step:"Quiz Início",users:1e3,dropoffRate:0},{step:"Pergunta 1-3",users:850,dropoffRate:15},{step:"Pergunta 4-6",users:720,dropoffRate:15.3},{step:"Pergunta 7-9",users:620,dropoffRate:13.9},{step:"Quiz Completo",users:580,dropoffRate:6.5}];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-deep-forest via-forest-green to-sage-green",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(A,{to:"/app/admin",children:e.jsx(l.button,{className:"p-2 rounded-lg bg-white/10 backdrop-blur-sm hover:bg-white/20 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(Q,{className:"w-5 h-5 text-white"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-sage-green/80",children:"Análise completa de métricas e performance da plataforma"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(l.button,{onClick:V,disabled:o||!r,className:"flex items-center space-x-2 px-4 py-2 bg-purple-500/20 hover:bg-purple-500/30 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:o?1:1.05},whileTap:{scale:o?1:.95},children:[o?e.jsx(B,{className:"w-4 h-4 text-purple-400 animate-spin"}):e.jsx(R,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-purple-400 font-medium",children:o?"Analisando...":"Análise AI"})]}),e.jsxs(l.button,{onClick:L,className:"flex items-center space-x-2 px-4 py-2 bg-royal-gold/20 hover:bg-royal-gold/30 rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(K,{className:"w-4 h-4 text-royal-gold"}),e.jsx("span",{className:"text-royal-gold font-medium",children:"Exportar"})]}),e.jsxs(l.button,{onClick:z,className:"flex items-center space-x-2 px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(_,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-red-400 font-medium",children:"Limpar"})]}),e.jsxs(l.button,{onClick:()=>N(s=>s+1),className:"flex items-center space-x-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(k,{className:"w-4 h-4 text-white"}),e.jsx("span",{className:"text-white font-medium",children:"Atualizar"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(G,{className:"w-8 h-8 text-royal-gold"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:r.events.length})]}),e.jsx("h3",{className:"text-white font-semibold mb-1",children:"Total de Eventos"}),e.jsx("p",{className:"text-sage-green/70 text-sm",children:"Interações registradas"})]}),e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(b,{className:"w-8 h-8 text-emerald-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:r.pageViews.length})]}),e.jsx("h3",{className:"text-white font-semibold mb-1",children:"Visualizações"}),e.jsx("p",{className:"text-sage-green/70 text-sm",children:"Total de páginas vistas"})]}),e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(k,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:r.redirects.length})]}),e.jsx("h3",{className:"text-white font-semibold mb-1",children:"Redirecionamentos"}),e.jsx("p",{className:"text-sage-green/70 text-sm",children:"Total de redirects"})]}),e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(j,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:r.redirects.filter(s=>s.destination==="/onboarding/welcome").length})]}),e.jsx("h3",{className:"text-white font-semibold mb-1",children:"Redirects Onboarding"}),e.jsx("p",{className:"text-sage-green/70 text-sm",children:"Para /onboarding/welcome"})]})]}),n&&e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(R,{className:"w-6 h-6 text-purple-400"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Análise Inteligente com Gemini AI"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-purple-400",children:[e.jsx("span",{children:"Confiança:"}),e.jsxs("span",{className:"font-semibold",children:[Math.round(n.confidence*100),"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center space-x-2",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{children:"Insights Principais"})]}),e.jsx("div",{className:"space-y-2",children:n.insights.map((s,t)=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{className:"text-pearl-white/80 text-sm",children:s})]},t))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center space-x-2",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"Recomendações"})]}),e.jsx("div",{className:"space-y-2",children:n.recommendations.map((s,t)=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-royal-gold rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{className:"text-pearl-white/80 text-sm",children:s})]},t))})]})]}),Object.keys(n.metrics).length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/10",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Métricas Calculadas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(n.metrics).map(([s,t])=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-white",children:typeof t=="number"?t.toFixed(2):t}),e.jsx("div",{className:"text-xs text-pearl-white/60 capitalize",children:s.replace(/_/g," ")})]},s))})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-white/10",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Resumo Executivo"}),e.jsx("p",{className:"text-pearl-white/80 text-sm leading-relaxed",children:n.summary})]})]}),e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(b,{className:"w-6 h-6 text-royal-gold"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Visualizações de Página por Usuário"})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(d).length>0?Object.entries(d).map(([s,t],a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-medium",children:s}),e.jsxs("p",{className:"text-sage-green/70 text-sm",children:[t.uniqueUsers," usuários únicos"]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-right",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold",children:t.views}),e.jsx("p",{className:"text-sage-green/70 text-xs",children:"visualizações"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold",children:M(t.avgTimeOnPage)}),e.jsx("p",{className:"text-sage-green/70 text-xs",children:"tempo médio"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-white font-semibold",children:[t.bounceRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-sage-green/70 text-xs",children:"taxa de rejeição"})]})]})]},a)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-sage-green/70",children:"Nenhum dado de visualização de página disponível ainda."}),e.jsx("p",{className:"text-sage-green/50 text-sm mt-2",children:"Os dados aparecerão conforme os usuários navegam pela plataforma."})]})})]}),e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(j,{className:"w-6 h-6 text-royal-gold"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Análise de Redirecionamentos"})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(m).length>0?Object.entries(m).map(([s,t],a)=>e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white font-medium",children:s}),e.jsxs("span",{className:"text-royal-gold font-semibold",children:[t.count," redirects"]})]}),e.jsxs("div",{className:"text-sm text-sage-green/70",children:[e.jsxs("p",{children:["Usuários únicos: ",t.uniqueUsers]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"font-medium text-sage-green/80",children:"Motivos:"}),Object.entries(t.reasons).map(([i,g])=>e.jsxs("span",{className:"inline-block bg-white/10 rounded px-2 py-1 text-xs mr-2 mt-1",children:[i,": ",g]},i))]})]})]},a)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-sage-green/70",children:"Nenhum redirecionamento registrado ainda."}),e.jsx("p",{className:"text-sage-green/50 text-sm mt-2",children:"Os dados aparecerão quando ocorrerem redirecionamentos."})]})})]}),e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20 mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(J,{className:"w-6 h-6 text-royal-gold"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Funil de Quiz - Taxa de Abandono"})]}),e.jsx("div",{className:"space-y-4",children:v.map((s,t)=>{const a=Math.max(...v.map(g=>g.users)),i=s.users/a*100;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white font-medium",children:s.step}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-royal-gold font-semibold",children:s.users.toLocaleString()}),s.dropoffRate>0&&e.jsxs("span",{className:"text-red-400 text-sm font-medium",children:["-",s.dropoffRate,"%"]})]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-3",children:e.jsx(l.div,{className:"bg-gradient-to-r from-royal-gold to-royal-gold/80 h-3 rounded-full",initial:{width:0},animate:{width:`${i}%`},transition:{duration:1,delay:t*.1}})})]},t)})})]}),e.jsxs(l.div,{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(W,{className:"w-6 h-6 text-royal-gold"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"Métricas de Crescimento"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:"2,450"}),e.jsx("div",{className:"text-sage-green/70",children:"Total de Usuários"}),e.jsx("div",{className:"text-green-400 text-sm mt-1",children:"+12% este mês"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:"78.5%"}),e.jsx("div",{className:"text-sage-green/70",children:"Taxa de Retenção"}),e.jsx("div",{className:"text-green-400 text-sm mt-1",children:"+5.2% vs mês anterior"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-white mb-2",children:"12:34"}),e.jsx("div",{className:"text-sage-green/70",children:"Duração Média da Sessão"}),e.jsx("div",{className:"text-green-400 text-sm mt-1",children:"+2:15 vs mês anterior"})]})]})]})]})})};export{te as default};
