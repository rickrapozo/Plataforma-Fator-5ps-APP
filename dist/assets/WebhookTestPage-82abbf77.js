import{b as w,j as e,T as m,u as v}from"./index-9af3c308.js";import{r as h}from"./vendor-abc4fb99.js";import{Z as p,m as a,_ as E,o as k,$ as T,g as I,n as _,I as A}from"./ui-4d99af29.js";import{a as R}from"./router-4d0cf74f.js";import"./pdf-eb8c75c2.js";const S=()=>{const{user:o}=w(),[r,l]=h.useState("Olá, como você pode me ajudar hoje?"),[n,i]=h.useState(!1),[c,d]=h.useState([]),t=(s,x)=>{d(N=>[...N,{type:s,message:x,timestamp:new Date}])},g=async()=>{i(!0),t("info","Testando webhook direto...");try{const s=await m.sendMessage({message:r,userId:o?.id||"test-user",userName:o?.name||"Test User",userEmail:o?.email||"test@example.com",context:{dailyProtocol:{completed:!1},userProgress:{streak:5,level:2,xp:150}}});t("success",`Resposta recebida: ${s.response.substring(0,100)}...`),s.suggestions?.length&&t("info",`Sugestões: ${s.suggestions.join(", ")}`)}catch(s){t("error",`Erro no teste direto: ${s instanceof Error?s.message:"Erro desconhecido"}`)}finally{i(!1)}},u=async()=>{i(!0),t("info","Testando webhook assíncrono...");try{await m.sendMessageWithCallback({message:r,userId:o?.id||"test-user",userName:o?.name||"Test User",userEmail:o?.email||"test@example.com",context:{dailyProtocol:{completed:!1},userProgress:{streak:5,level:2,xp:150}}},s=>{t("success",`Resposta assíncrona: ${s.response.substring(0,100)}...`),s.suggestions?.length&&t("info",`Sugestões: ${s.suggestions.join(", ")}`),i(!1)}),t("info","Mensagem enviada, aguardando resposta...")}catch(s){t("error",`Erro no teste assíncrono: ${s instanceof Error?s.message:"Erro desconhecido"}`),i(!1)}},b=async()=>{t("info","Simulando resposta do webhook...");try{await m.simulateWebhookResponse(o?.id||"test-user",r),t("success","Simulação de webhook iniciada")}catch(s){t("error",`Erro na simulação: ${s instanceof Error?s.message:"Erro desconhecido"}`)}},f=async()=>{t("info","Testando conexão com n8n...");try{await m.testConnection()?t("success","Conexão com n8n estabelecida com sucesso"):t("error","Falha na conexão com n8n")}catch(s){t("error",`Erro no teste de conexão: ${s instanceof Error?s.message:"Erro desconhecido"}`)}},j=()=>{d([])},y=s=>{switch(s){case"success":return e.jsx(k,{className:"w-4 h-4 text-success-green"});case"error":return e.jsx(E,{className:"w-4 h-4 text-error-red"});default:return e.jsx(p,{className:"w-4 h-4 text-royal-gold"})}};return e.jsxs("div",{className:"glass-card p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(p,{className:"w-6 h-6 text-royal-gold"}),e.jsx("h2",{className:"text-white text-xl font-heading font-bold",children:"Testador de Webhook N8N"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-pearl-white/80 text-sm font-medium mb-2",children:"Mensagem de Teste"}),e.jsx("textarea",{value:r,onChange:s=>l(s.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-pearl-white/50 focus:outline-none focus:border-royal-gold resize-none",rows:3,placeholder:"Digite uma mensagem para testar o webhook..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(a.button,{onClick:f,disabled:n,className:"neuro-button bg-sage-green hover:bg-sage-green/80 text-white py-3 px-4 rounded-lg font-medium transition-colors disabled:opacity-50",whileTap:{scale:.98},children:"Testar Conexão"}),e.jsx(a.button,{onClick:g,disabled:n||!r.trim(),className:"neuro-button bg-royal-gold hover:bg-royal-gold/80 text-white py-3 px-4 rounded-lg font-medium transition-colors disabled:opacity-50",whileTap:{scale:.98},children:"Webhook Direto"}),e.jsx(a.button,{onClick:u,disabled:n||!r.trim(),className:"neuro-button bg-deep-forest hover:bg-deep-forest/80 text-white py-3 px-4 rounded-lg font-medium transition-colors disabled:opacity-50",whileTap:{scale:.98},children:"Webhook Assíncrono"}),e.jsx(a.button,{onClick:b,disabled:n||!r.trim(),className:"neuro-button bg-forest-green hover:bg-forest-green/80 text-white py-3 px-4 rounded-lg font-medium transition-colors disabled:opacity-50",whileTap:{scale:.98},children:"Simular Resposta"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-white text-lg font-semibold",children:"Resultados dos Testes"}),c.length>0&&e.jsx(a.button,{onClick:j,className:"text-pearl-white/60 hover:text-white text-sm transition-colors",whileTap:{scale:.98},children:"Limpar"})]}),e.jsx("div",{className:"bg-black/20 rounded-lg p-4 max-h-96 overflow-y-auto",children:c.length===0?e.jsx("p",{className:"text-pearl-white/60 text-center py-8",children:"Nenhum teste executado ainda"}):e.jsx("div",{className:"space-y-2",children:c.map((s,x)=>e.jsxs(a.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex items-start space-x-3 p-3 bg-white/5 rounded-lg",children:[y(s.type),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm",children:s.message}),e.jsx("p",{className:"text-pearl-white/50 text-xs mt-1",children:s.timestamp.toLocaleTimeString()})]})]},x))})})]}),n&&e.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center justify-center space-x-2 mt-4 p-4 bg-royal-gold/10 rounded-lg",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-royal-gold border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-royal-gold font-medium",children:"Executando teste..."})]})]})},O=()=>{const o=R(),{isLoading:r,isAuthorized:l,error:n,logAction:i}=v();return h.useEffect(()=>{if(!l)return;(async()=>{try{await i("access_webhook_test",{page:"WebhookTestPage"})}catch(d){console.error("Erro ao registrar acesso ao teste de webhook:",d)}})()},[l,i]),r?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-deep-forest to-forest-green flex items-center justify-center p-4",children:e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-card p-8 text-center",children:[e.jsx(T,{className:"w-8 h-8 text-royal-gold animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white",children:"Verificando permissões..."})]})}):!l||n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-deep-forest to-forest-green flex items-center justify-center p-4",children:e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-card p-8 text-center max-w-md",children:[e.jsx(I,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-white text-2xl font-heading font-bold mb-4",children:"Acesso Negado"}),e.jsx("p",{className:"text-pearl-white/80 text-body-md mb-6",children:"Você não tem permissão para acessar o teste de webhooks."}),e.jsx(a.button,{onClick:()=>o("/dashboard"),className:"w-full bg-gradient-to-r from-royal-gold to-bright-gold text-white py-3 rounded-lg font-semibold",whileTap:{scale:.98},children:"Voltar ao Dashboard"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-deep-forest to-forest-green",children:[e.jsx(a.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-black/20 backdrop-blur-sm border-b border-white/10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(a.button,{onClick:()=>o("/admin"),className:"p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors",whileTap:{scale:.98},children:e.jsx(_,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-white text-2xl font-heading font-bold",children:"Teste de Webhook N8N"}),e.jsx("p",{className:"text-pearl-white/80 text-sm",children:"Ferramenta de diagnóstico para o Terapeuta AI"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-card p-6 mb-8",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(A,{className:"w-6 h-6 text-royal-gold flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Como Funciona o Sistema de Webhook"}),e.jsxs("div",{className:"text-pearl-white/80 text-sm space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Webhook Direto:"})," Envia mensagem e aguarda resposta síncrona do n8n (timeout: 30s)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Webhook Assíncrono:"})," Envia mensagem e registra callback para receber resposta posterior"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Simulação:"})," Testa o sistema de callbacks sem depender do n8n externo"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"URL Atual:"})," ",e.jsx("code",{className:"bg-black/20 px-2 py-1 rounded text-royal-gold",children:"https://fator5ps.app.n8n.cloud/webhook-test/a95c2946-75d2-4e20-82bf-f04442a5cdbf"})]})]})]})]})}),e.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(S,{})}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-card p-6 mt-8",children:[e.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Detalhes Técnicos"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-royal-gold font-medium mb-2",children:"Fluxo de Dados"}),e.jsxs("ul",{className:"text-pearl-white/80 text-sm space-y-1",children:[e.jsx("li",{children:"1. Frontend envia mensagem para n8n"}),e.jsx("li",{children:"2. N8n processa com IA (GPT/Claude)"}),e.jsx("li",{children:"3. N8n retorna resposta via webhook"}),e.jsx("li",{children:"4. WebhookService processa resposta"}),e.jsx("li",{children:"5. Callback atualiza interface"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-royal-gold font-medium mb-2",children:"Configurações"}),e.jsxs("ul",{className:"text-pearl-white/80 text-sm space-y-1",children:[e.jsx("li",{children:"Timeout: 30s (direto) / 45s (assíncrono)"}),e.jsx("li",{children:"Retry: Automático em caso de falha"}),e.jsx("li",{children:"Fallback: Respostas padrão de erro"}),e.jsx("li",{children:"Logging: Console + Supabase"})]})]})]})]})]})]})};export{O as default};
